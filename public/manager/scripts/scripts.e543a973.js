"use strict";String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var App=angular.module("erestoApp",["ngCookies","ui.router","ngSanitize","ngTouch","LocalStorageModule","restangular","angularify.semantic","ngProgress","angularMoment","ngConfirm","autocomplete","ngFileUpload","ngImgCrop","ngLodash","nvd3ChartDirectives","ui.timepicker","localytics.directives"]);App.config(["localStorageServiceProvider","RestangularProvider","$httpProvider",function(a,b,c){var d=window.location.hostname;d="localhost"===d?"":d,a.setPrefix("eresto").setStorageType("sessionStorage").setStorageCookieDomain(d),b.setBaseUrl("http://192.168.1.253/v1").setDefaultHttpFields({timeout:6e5}),c.interceptors.push("APIInterceptor")}]).service("APIInterceptor",["$rootScope","localStorageService","$q","$injector",function(a,b,c,d){var e=this;e.request=function(d){d.params||(d.params={});var e=null;return e=null===a.token||void 0===a.token?b.get("token"):a.token,d.params.token=e,d||c.when(d)},e.responseError=function(a){return 401===a.status?(b.set("token",null),d.get("$state").transitionTo("welcome"),c.reject(a)):c.reject(a)},e.response=function(b){var c=b.data.total;return c>0&&(console.log(b.data),console.log(c),a.total=c),b}}]).run(["$rootScope","$state","$stateParams","Authenticate","Cancan","ngProgress","$window",function(a,b,c,d,e,f,g){a.$on("$stateChangeStart",function(b,c,g){f.start(),a.toState=c,a.toStateParams=g,a.page=1,e.isIdentityResolved()&&d.authorize()}),a.$on("$stateChangeSuccess",function(){f.complete(),g.scrollTo(0,0)}),a.$on("$stateChangeError",function(){f.complete()})}]),angular.module("ui.timepicker").value("uiTimepickerConfig",{step:10,asMoment:!0,timeFormat:"H:i"}),angular.module("erestoApp").controller("AuthCtrl",["$scope","$rootScope","User","localStorageService","$state","$timeout",function(a,b,c,d,e,f){b.controller="login";var g=d.get("token");null!==g&&e.go("app.dashboard"),a.doLogin=function(){c.authenticate(a.user).then(function(b){"cashier"!==b.role?(d.set("token",b.token),f(function(){e.go("app.dashboard",{token:b.token})},200)):a.signInError="You're not authorize to use this application."},function(b){var c="User parameter is required"===b.data.message?"Email and password cannot be blank":b.data.message;a.signInError="Oops, "+c})}}]),angular.module("erestoApp").controller("DashboardCtrl",["$rootScope","$scope","$stateParams","Order","lodash","Restangular","User","Outlet","currentUser",function(a,b,c,d,e,f,g,h,i){function j(){a.user&&"tenant"===a.user.role&&(a.tenant_id_ord=a.user.id,a.tenant_id_cust=a.user.id,a.tenant_id_rev=a.user.id,a.tenant_id_tax=a.user.id,a.tenant_id=a.user.id)}a.token=c.token,a.graphRevenue="today",a.graphOrder="today",a.graphCustomer="today",a.graphTax="today",a.outlet_id_ord="",a.outlet_id_cust="",a.outlet_id_rev="",a.outlet_id_tax="",a.tenant_id_ord="",a.tenant_id_cust="",a.tenant_id_rev="",a.tenant_id_tax="",b.exampleData=[],a.user=i,a.tenant_id=null,j();var k=function(){f.all("orders").customGET("get_order_quantity",{tenant_id:a.tenant_id}).then(function(a){var c=e.sortByAll(a,function(a){return a[1]}).reverse(),d=e.chunk(c,5),f=e.chunk(c.reverse(),5);b.tops=e.first(d),b.bots=e.first(f),b.bots=e.map(b.bots,function(a){return{key:a[0],y:a[1]}}),b.tops=e.map(b.tops,function(a){return{key:a[0],y:a[1]}})})};k();var l=function(){var c={timeframe:a.graphRevenue,tenant_id:a.tenant_id_rev,outlet_id:a.outlet_id_rev};d.getGraphRevenue(c).then(function(a){var c=e.groupBy(a,function(a){return a[0]}),d=[];e.forEach(c,function(a,b){var c=[];c[0]=parseInt(b),c[1]=e.sum(a,function(a){return a[1]}),d.push(c)}),b.exampleData=[{key:"Revenue",values:d}],b.totalRevenue="Rp "+d3.format(",")(e.sum(d,function(a){return a[1]}))})},m=function(a,c){g.getAll("tenant",a).then(function(a){b["tenants_"+c]=a.users})},n=function(a){h.getAll().then(function(c){b["outlets_"+a]=c.outlets})};a.$watch("outlet_id_cust",function(a){m(a,"cust")},!0),a.$watch("outlet_id_ord",function(a){m(a,"ord")},!0),a.$watch("outlet_id_rev",function(a){m(a,"rev")},!0),a.$watch("outlet_id_tax",function(a){m(a,"tax")},!0),l(),n("cust"),n("ord"),n("rev"),n("tax"),a.$watch("graphRevenue",function(a,b){a!==b&&l()}),a.$watch("outlet_id_rev",function(a,b){a!==b&&l()}),a.$watch("tenant_id_rev",function(a,b){a!==b&&l()});var o=function(){var c={timeframe:a.graphCustomer,tenant_id:a.tenant_id_cust,outlet_id:a.outlet_id_cust};d.getGraphPax(c).then(function(a){var c=e.groupBy(a,function(a){return a[0]}),d=[];e.forEach(c,function(a,b){var c=[];c[0]=parseInt(b),c[1]=e.sum(a,function(a){return a[1]}),d.push(c)}),b.exampleData3=[{key:"Customer",values:d}],b.totalCustomer=e.sum(d,function(a){return a[1]})})};o(),a.$watch("graphCustomer",function(a,b){a!==b&&o()}),a.$watch("tenant_id_cust",function(a,b){a!==b&&o()}),a.$watch("outlet_id_cust",function(a,b){a!==b&&o()});var p=function(){var c={timeframe:a.graphOrder,tenant_id:a.tenant_id_ord,outlet_id:a.outlet_id_ord};d.getGraphOrder(c).then(function(a){var c=e.groupBy(a,function(a){return a[0]}),d=[];e.forEach(c,function(a,b){var c=[];c[0]=parseInt(b),c[1]=e.sum(a,function(a){return a[1]}),d.push(c)}),b.exampleData2=[{key:"Order",values:d}],b.totalOrder=e.sum(d,function(a){return a[1]})})};p(),a.$watch("graphOrder",function(a,b){a!==b&&p()}),a.$watch("tenant_id_ord",function(a,b){a!==b&&p()}),a.$watch("outlet_id_ord",function(a,b){a!==b&&p()});var q=function(){var c={timeframe:a.graphTax,tenant_id:a.tenant_id_tax,outlet_id:a.outlet_id_tax};d.getGraphTax(c).then(function(a){var c=e.groupBy(a,function(a){return a[0]}),d=[];e.forEach(c,function(a,b){var c=[];c[0]=parseInt(b),c[1]=e.sum(a,function(a){return a[1]}),d.push(c)}),b.exampleData4=[{key:"Tax",values:d}],b.totalTax="Rp "+d3.format(",")(e.sum(d,function(a){return a[1]}))})};q(),a.$watch("graphTax",function(a,b){a!==b&&q()}),a.$watch("tenant_id_tax",function(a,b){a!==b&&q()}),a.$watch("outlet_id_tax",function(a,b){a!==b&&q()}),b.xFormat=function(a){return moment(a).format("DD/MM/YYYY")},b.yFormat=function(a){return d3.format(",")(a)},b.yPadding=function(){return 100},b.xFunction=function(){return function(a){return a.key}},b.yFunction=function(){return function(a){return a.y}}}]),angular.module("erestoApp").controller("DiscountsCtrl",["$scope","$rootScope","Discount","Restangular","lodash","Outlet","Cloud",function(a,b,c,d,e,f,g){a.discounts={},a.selected={},a.products=[],a.outlets=[],a.formType="existing",a.selectedID=null,b.controller="discounts",b.canAdd=!0,b.total=1,b.initial=function(b){var e=b||1;d.one("outlets","all").get().then(function(b){a.outlets=b.outlets,d.one("products","all").get().then(function(b){a.products=b.products,console.log(a.products),c.getData(e).then(function(b){a.discounts=b.discounts,jQuery(".search").removeClass("loading"),b.discounts.length>0?(a.selected=angular.copy(b.discounts[0]),a.selectedID=0,a.discountType=a.selected.percentage?"percentage":"amount"):a.formType="new"})})})},b.addNew=function(){a.selected={},a.formType="new",jQuery(".selection.dropdown .text").html("Select Product")},a.selectDiscount=function(b){a.selected=angular.copy(a.discounts[b]),a.discountType=a.selected.percentage?"percentage":"amount",a.selectedID=b,a.formType="existing",jQuery("label.error").remove()},a.days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],a.time=["00:00","00:10","00:20","00:30","00:40","00:50","01:00","01:10","01:20","01:30","01:40","01:50","02:00","02:10","02:20","02:30","02:40","02:50","03:00","03:10","03:20","03:30","03:40","03:50","04:00","04:10","04:20","04:30","04:40","04:50","05:00","05:10","05:20","05:30","05:40","05:50","06:00","06:10","06:20","06:30","06:40","06:50","07:00","07:10","07:20","07:30","07:40","07:50","08:00","08:10","08:20","08:30","08:40","08:50","09:00","09:10","09:20","09:30","09:40","09:50","10:00","10:10","10:20","10:30","10:40","10:50","11:00","11:10","11:20","11:30","11:40","11:50","12:00","12:10","12:20","12:30","12:40","12:50","13:00","13:10","13:20","13:30","13:40","13:50","14:00","14:10","14:20","14:30","14:40","14:50","15:00","15:10","15:20","15:30","15:40","15:50","16:00","16:10","16:20","16:30","16:40","16:50","17:00","17:10","17:20","17:30","17:40","17:50","18:00","18:10","18:20","18:30","18:40","18:50","19:00","19:10","19:20","19:30","19:40","19:50","20:00","20:10","20:20","20:30","20:40","20:50","21:00","21:10","21:20","21:30","21:40","21:50","22:00","22:10","22:20","22:30","22:40","22:50","23:00","23:10","23:20","23:30","23:40","23:50"],a.checkType=function(){"percentage"===a.discountType?a.selected.amount=null:a.selected.percentage=null},a.saveData=function(){var b=jQuery(".entry-form");b.validate(),b.valid()&&("new"===a.formType?c.save(a.selected).then(function(b){a.discounts.push(b.discount),a.selected=angular.copy(b.discount),h()},function(a){422===a.status&&(c.handle422(a.data),h())}):c.update(a.selected).then(function(b){a.discounts[a.selectedID]=b.discount,a.selected=angular.copy(b.discount),h()},function(a){422===a.status&&(c.handle422(a.data),h())}))},a.deleteData=function(){c["delete"](a.selected).then(function(b){a.discounts[a.selectedID]=b.discount,a.selected=angular.copy(b.discount),a.discounts.splice(a.selectedID,1),a.discounts.length>0?(a.selectedID=0,a.selectDiscount(0)):(a.selected={},a.formType="new"),h()},function(a){422===a.status&&(c.handle422(a.data),h())})};var h=function(){jQuery(".content-workspace > .dimmer").removeClass("active")};a.resync=function(){f.getData(1).then(function(c){if(c.outlets&&c.outlets.length>0){var e=c.outlets[0].id;g.one("discounts","all").customGET("",{outlet_id:e}).then(function(c){d.all("sync").customPOST(c,null,{},{}).then(function(){b.initial(1)}),a.discountLoading=!1})}else a.discountLoading=!1})}}]),angular.module("erestoApp").controller("MainCtrl",["$rootScope","$scope","localStorageService","$state","currentUser","$timeout","$stateParams","Cloud","$q","Restangular",function(a,b,c,d,e,f,g,h,i,j){a.$state=d,a.token=g.token,a.user=e,a.stateWithList=["app.restricted.staff","app.restricted.products","app.restricted.tables","app.restricted.discounts"],a.doesntHavePage=["app.restricted.tables","app.restricted.settings"],a.state=d,a.page=1,a.controller="default",a.search=null,a.syncError=!1,a.syncActive=!1,a.countPage=function(){return isNaN(Math.ceil(a.total/10))?1:Math.ceil(a.total/10)},b.userPrivilage=function(a,b){var c=a.role;switch(b){case"dashboard":return"manager"==c||"tenant"==c||"owner"==c||"admin"==c;case"reports":return"manager"==c||"tenant"==c||"owner"==c||"admin"==c;case"staff":return"manager"==c||"admin"==c;case"products":return"manager"==c||"admin"==c;case"discounts":return"manager"==c||"admin"==c;case"tables":return"manager"==c||"admin"==c;case"settings":return"manager"==c||"admin"==c||"owner"==c||"tenant"==c;case"outlets":return"manager"==c||"admin"==c||"owner"==c}},a.nextPage=function(){a.countPage()>a.page&&(a.page+=1,a.initial(a.page))},a.prevPage=function(){a.page>1&&(a.page-=1,a.initial(a.page))};var k=c.get("token");null===k&&d.go("welcome"),a.doLogout=function(){delete a.token,c.remove("token"),f(function(){d.go("welcome")},100)},a.sync=function(){jQuery(".ui.modal").modal("setting","closable",!1).modal("show")},a.doSync=function(){a.syncActive="downloading";var b=h.one("products","all").get(),c=h.one("outlets",a.outlet_id).get(),e=h.one("users","all").customGET("",{"filter[outlet_id]":a.outlet_id}),f=h.one("product_categories","all").get(),g=h.one("discounts","all").customGET("",{"filter[outlet_id]":a.outlet_id});i.all([b,e,c,f,g]).then(function(b){a.syncActive="saving",j.all("sync").customPOST(angular.extend(b[0],b[1],b[2],b[3],b[4]),null,{},{}).then(function(){jQuery(".ui.modal").modal("hide"),a.syncActive=!1,a.syncError=!1,d.go("app.dashboard")},function(){a.syncError=!0,a.syncActive=!1})},function(){a.syncError=!0,a.syncActive=!1}),a.$watch("outlet_id",function(b,c){b!==c&&(a.syncError=!1)})}}]),angular.module("erestoApp").controller("OrdersCtrl",["$scope","$rootScope","Order","User","Outlet","currentUser","Excel","$timeout",function(a,b,c,d,e,f,g,h){function i(){b.user&&"tenant"===b.user.role&&(b.filter.tenant_id=b.user.id)}b.orders=[],b.controller="reports",b.filter={},b.filter.page=1,b.filter.page_size=10,a.tenants=[],b.user=f,a.exportToExcel=function(a){var b=g.tableToExcel(a,"order list");h(function(){location.href=b},100)},i();var j=new Date;b.filter.dateEnd=moment(j).format("DD/MM/YYYY"),b.filter.dateStart=moment(j.setDate(j.getDate()-7)).format("DD/MM/YYYY");var k=function(a){return isNaN(Math.ceil(a/b.filter.page_size))?1:Math.ceil(a/b.filter.page_size)},l=function(){jQuery(".dimmer.orders").addClass("active"),c.getData(b.filter).then(function(a){b.orders=a.orders,b.total=k(a.total),b.selected=a.orders[0],jQuery(".dimmer.orders").removeClass("active")},function(){jQuery(".dimmer.orders").removeClass("active")})},m=function(b){d.getAll("tenant",b).then(function(b){a.tenants=b.users,l()})},n=function(){e.getAll().then(function(b){a.outlets=b.outlets})};n(),b.$watch("filter.outlet_id",function(a){b.filter.page=1,m(a)},!0),b.$watch("filter.tenant_id",function(a){b.filter.page=1,m(a)},!0),a.viewData=function(a){b.selected=a,jQuery(".content-workspace").addClass("active")},a.searchData=function(){l()},a.dataPage=function(a){b.filter.page=a,l()}}]),angular.module("erestoApp").controller("OutletsCtrl",["$scope","$rootScope","Outlet",function(a,b,c){a.outlets={},a.selected={},a.formType="new",a.selectedID=null,b.controller="outlets",b.canAdd=!1,b.total=1,b.initial=function(b){var e=b||1;c.getData(e).then(function(b){void 0!==b.outlets&&(a.outlets=b.outlets,jQuery(".search").removeClass("loading"),b.outlets.length>0?(a.selected=angular.copy(b.outlets[0]),a.selected.taxs=d(b.outlets[0].taxs),a.formType="existing",a.selectedID=0):(a.selected={},a.formType="new"))})};var d=function(a){return(null===a||void 0===a)&&(a={}),Object.keys(a).map(function(b){return{label:b,value:a[b]}})},e=function(a){(null===a||void 0===a)&&(a=[]);for(var b={},c=a.length-1;c>=0;c--)"0"!==a[c].value&&(b[a[c].label]=a[c].value);return b};b.addNew=function(){a.selected={},a.formType="new"},a.selectOutlet=function(b){a.selected=angular.copy(a.outlets[b]),a.selected.taxs=d(a.outlets[b].taxs),a.selectedID=b,a.formType="existing",jQuery("label.error").remove(),jQuery("input.error, select.error, textarea.error").removeClass("error")},a.addTax=function(){null===a.selected.taxs&&(a.selected.taxs=[]),a.selected.taxs.push({label:"New tax",value:0})},a.saveData=function(){var b=jQuery(".entry-form");b.validate(),b.valid()&&(a.selected.taxs=e(a.selected.taxs),"new"===a.formType?c.save(a.selected).then(function(b){a.outlets.push(b.outlet),a.selected=angular.copy(b.outlet),a.selected.taxs=d(b.outlet.taxs),f()},function(a){422===a.status&&(c.handle422(a.data),f())}):c.update(a.selected).then(function(b){a.outlets[a.selectedID]=b.outlet,a.selected=angular.copy(b.outlet),a.selected.taxs=d(b.outlet.taxs),f()},function(a){422===a.status&&(c.handle422(a.data),f())}))};var f=function(){jQuery(".content-workspace > .dimmer").removeClass("active")}}]),angular.module("erestoApp").controller("ProductsCtrl",["$scope","$rootScope","Product","User","lodash",function(a,b,c,d,e){a.products={},a.lodash=e,a.selected={},a.selected.result="",a.formType="new",a.selectedID=null,a.categories=[],a.cat_names=[],a.sub_names=[],a.category={sub_categories:[]},a.imageError=!1,a.imageErrorMsg=null,b.controller="products",b.canAdd=!0,b.total=1,b.users=[],b.initial=function(b){var d=b||1;f("tenant").then(function(){g().then(function(){c.getData(d).then(function(b){void 0!==b.products&&(a.products=b.products,jQuery(".search").removeClass("loading"),b.products.length>0?(a.selected=angular.copy(b.products[0]),a.selected.result="",a.formType="existing",a.selectedID=0):(a.selected={},a.formType="new"))})})})},a.$watch("selected.serv_category",function(b){a.category=e.find(a.categories,{name:b}),a.category&&(a.sub_names=e.pluck(a.category.sub_categories,"name"),e.includes(a.sub_names,a.selected.serv_sub_category)||(a.selected.serv_sub_category=""))},!0);var f=function(b){return d.getAll(b).then(function(b){a.users=b.users})},g=function(){return c.category().then(function(b){void 0!==b.categories&&(a.categories=b.categories,a.cat_names=e.pluck(b.categories,"name"))})};a.setCategory=function(){a.category=e.find(a.category,{id:a.selected.category})};var h=function(a){return a.substr(a.lastIndexOf(".")+1)};b.addNew=function(){a.cat_names=e.pluck(a.categories,"name"),a.selected={},a.selected.result="",a.formType="new"},a.addChoice=function(){a.selected.choices||(a.selected.choices=[]),a.selected.choices.push({name:"",id:""})},a.removeChoice=function(b){a.selected.choices.splice(b,1)},a.removePicture=function(){a.selected.picture_base64=null,a.selected.picture=null},a.selectProduct=function(b){a.selected=angular.copy(a.products[b]),a.selectedID=b,a.formType="existing",a.selected.result="",a.imageError=!1,jQuery("label.error").remove(),jQuery("input.error, select.error, textarea.error").removeClass("error")},a.$watch("files",function(){var b=a.files;b&&!b.type.match(/^image\//)?(a.imageError=!0,a.imageErrorMsg="Only image allowed."):(a.imageError=!1,a.upload(a.files))});var i=function(a,b){var c=new FileReader;c.onload=b,c.readAsDataURL(a)};a.upload=function(b){if(b){var c=b;angular.extend(a.selected,{picture_extension:h(c.name),picture:c.name}),i(c,function(b){angular.extend(a.selected,{picture_base64:b.target.result}),a.$apply()})}},a.saveData=function(){var b=jQuery(".entry-form");b.validate(),b.valid()&&(a.imageError=!1,a.selected.picture_base64=a.selected.result,"new"===a.formType?c.save(a.selected).then(function(b){a.products.push(b.product),a.selected=angular.copy(b.product),a.selected.result="",a.formType="existing",g(),j()},function(a){422===a.status&&(c.handle422(a.data),j())}):c.update(a.selected).then(function(b){a.products[a.selectedID]=b.product,a.selected=angular.copy(b.product),a.selected.result="",g(),j()},function(a){422===a.status&&(c.handle422(a.data),j())}))},a.deleteData=function(){a.selected.active=!1,c.update(a.selected).then(function(){a.products.splice(a.selectedID,1),a.products.length>0?(a.selectedID=0,a.selectProduct(0)):(a.selected={},a.formType="new",a.selected.result=""),g(),j()},function(a){422===a.status&&(c.handle422(a.data),j())})};var j=function(){jQuery(".content-workspace > .dimmer").removeClass("active")}}]),angular.module("erestoApp").controller("ReportsCtrl",["$scope","$rootScope","Order","User","Outlet","currentUser","Excel","$timeout",function(a,b,c,d,e,f,g,h){function i(){b.user&&"tenant"===b.user.role&&(b.filter.tenant_id=b.user.id)}b.orders=[],b.controller="reports",b.filter={},b.filter.page=1,b.filter.page_size=10,a.tenants=[],b.user=f,a.exportToExcel=function(a){var b=g.tableToExcel(a,"order list");h(function(){location.href=b},100)},a.totalTaxes=function(a){return _.sum(a,"tax_amount")},a.totalPaid=function(a){return _.sum(a,"paid_amount")},a.totalQuantity=function(a){return _.sum(a,"quantity")},a.totalPaidQuantity=function(a){return _.sum(a,"paid_quantity")},a.totalOcQuantity=function(a){return _.sum(a,"oc_quantity")},a.totalVoidQuantity=function(a){return _.sum(a,"void_quantity")},i();var j=new Date;b.filter.dateEnd=moment(j).format("DD/MM/YYYY"),b.filter.dateStart=moment(j.setDate(j.getDate()-7)).format("DD/MM/YYYY");var k=function(a){return isNaN(Math.ceil(a/b.filter.page_size))?1:Math.ceil(a/b.filter.page_size)},l=function(){jQuery(".dimmer.orders").addClass("active"),c.getProductSales(b.filter).then(function(a){b.orders=a.result,b.total=k(1),b.selected=a.result[0],jQuery(".dimmer.orders").removeClass("active")},function(){jQuery(".dimmer.orders").removeClass("active")})},m=function(b){d.getAll("tenant",b).then(function(b){a.tenants=b.users,l()})},n=function(){e.getAll().then(function(b){a.outlets=b.outlets})};n(),b.$watch("filter.outlet_id",function(a){b.filter.page=1,m(a)},!0),b.$watch("filter.tenant_id",function(a){b.filter.page=1,m(a)},!0),a.viewData=function(a){b.selected=a,jQuery(".content-workspace").addClass("active")},a.searchData=function(){l()},a.dataPage=function(a){b.filter.page=a,l()}}]),angular.module("erestoApp").controller("SettingsCtrl",["$scope","$rootScope","User","Outlet","Printer",function(a,b,c,d,e){a.printers=[],a.this_user=angular.copy(b.user),a.addPrinter=!1,b.controller="settings",a.newprinter={},d.getData(1).then(function(b){a.outlet=b.outlets[0]});var f=function(){e.getData().then(function(b){a.printers=b.printers,jQuery(".dimmer.printer").removeClass("active")},function(){jQuery(".dimmer.printer").removeClass("active")})};f(),a.updateUser=function(){jQuery(".dimmer.user").addClass("active"),c.update(a.this_user).then(function(){jQuery(".dimmer.user").removeClass("active")},function(){jQuery(".dimmer.user").removeClass("active")})},a.updateOutlet=function(){jQuery(".dimmer.outlet").addClass("active"),d.update(a.outlet).then(function(){jQuery(".dimmer.outlet").removeClass("active")},function(){jQuery(".dimmer.outlet").removeClass("active")})};var g=function(){jQuery("#newprinter-name").val(""),jQuery("#newprinter-printer").val(""),jQuery("#newprinter-default").prop("checked",!1)};a.cancelAddPrinter=function(){jQuery("#addPrinter").addClass("ng-hide")},a.showAddPrinter=function(){jQuery("#addPrinter").removeClass("ng-hide")},a.savePrinter=function(){var b={name:jQuery("#newprinter-name").val(),printer:jQuery("#newprinter-printer").val(),"default":jQuery("#newprinter-default").is(":checked")};e.save(b).then(function(){jQuery(".dimmer.printer").removeClass("active"),f(),g(),a.cancelAddPrinter()},function(){jQuery(".dimmer.printer").removeClass("active")})},a.deletePrinter=function(b){e["delete"](b).then(function(){jQuery(".dimmer.printer").removeClass("active"),f(),g(),a.cancelAddPrinter()},function(){jQuery(".dimmer.printer").removeClass("active")})}}]),angular.module("erestoApp").controller("StaffCtrl",["$scope","$rootScope","User","Outlet",function(a,b,c,d){a.users={},a.outlets={},a.selected={},a.formType="existing",a.selectedID=null,b.controller="users",b.search=!1,b.canAdd=!0,b.total=1,a.roles=[{title:"Owner",value:"owner"},{title:"Manager",value:"manager"},{title:"Captain",value:"captain"},{title:"Tenant",value:"tenant"},{title:"Cashier",value:"cashier"}],b.initial=function(b){var e=b||1;d.getAll().then(function(b){void 0!==b.outlets&&(a.outlets=b.outlets,jQuery(".search").removeClass("loading"))}),c.getData(e).then(function(b){a.users=b.users,jQuery(".search").removeClass("loading"),b.users.length>0&&(a.selected=angular.copy(b.users[0]),a.selectedID=0,h())})},b.addNew=function(){a.selected={role:"tenant"},a.formType="new"},a.selectUser=function(b){a.selected=angular.copy(a.users[b]),a.selectedID=b,a.formType="existing",jQuery("label.error").remove(),jQuery("input.error, select.error, textarea.error").removeClass("error"),h()},a.saveData=function(){var b=jQuery(".entry-form");b.validate(),b.valid()&&(a.selected.profile_attributes.join_at=g(a.selected.profile_attributes.join_at),a.selected.profile_attributes.contract_until=g(a.selected.profile_attributes.contract_until),"new"===a.formType?c.save(a.selected).then(function(b){a.users.push(b.user),a.selected=angular.copy(b.user),h(),e()},function(a){422===a.status&&(c.handle422(a.data),e())}):c.update(a.selected).then(function(b){a.users[a.selectedID]=b.user,a.selected=angular.copy(b.user),h(),e()},function(a){422===a.status&&(c.handle422(a.data),e())}))};var e=function(){jQuery(".content-workspace > .dimmer").removeClass("active")},f=function(a){return null!==a||void 0!==a?moment(a).format("ddd, D MMM YYYY"):" "},g=function(a){return null!==a||void 0!==a?moment(a).format("YYYY-MM-D"):" "},h=function(){a.selected.profile_attributes.join_at=f(a.selected.profile_attributes.join_at),a.selected.profile_attributes.contract_until=f(a.selected.profile_attributes.contract_until)}}]),angular.module("erestoApp").controller("TablesCtrl",["$scope","$rootScope","Table","lodash",function(a,b,c,d){a.tables={},a.selected={},a.formType="new",a.selectedID=null,b.controller="tables",b.canAdd=!0,b.total=1,b.initial=function(){c.getData().then(function(b){if(void 0!==b.tables){a.tables=[];var c=b.tables,e=d.groupBy(c,function(a){return a.location});d.each(e,function(b){var c=d.sortBy(b,function(a){return a.name}),e={location:d.first(c).location,start:parseInt(d.first(c).name),end:parseInt(d.last(c).name)};a.tables.push(e)}),jQuery(".search").removeClass("loading"),a.tables.length>0?(a.selected=angular.copy(a.tables[0]),a.formType="existing",a.selectedID=0):(a.selected={},a.formType="new")}})},b.addNew=function(){a.selected={},a.selected.result="",a.formType="new"},a.selectTable=function(b){a.selected=angular.copy(a.tables[b]),a.selectedID=b,a.formType="existing",jQuery("label.error").remove(),jQuery("input.error, select.error, textarea.error").removeClass("error")},a.saveData=function(){var b=jQuery(".entry-form");b.validate(),a.hasError=a.selected.start>a.selected.end,b.valid()&&!a.hasError&&("new"===a.formType?c.save(a.selected).then(function(b){a.tables.push(b.table),a.selected=angular.copy(b.table),a.formType="existing",e()},function(a){422===a.status&&(c.handle422(a.data),e())}):c.update(a.selected).then(function(b){a.tables[a.selectedID]=b.table,a.selected=angular.copy(b.table),e()},function(a){422===a.status&&(c.handle422(a.data),e())}))},a.deleteData=function(){a.selected.start=0,a.selected.end=0,c.update(a.selected).then(function(){a.tables.splice(a.selectedID,1),a.tables.length>0?(a.selectedID=0,a.selectTable(0)):(a.selected={},a.formType="new"),e()},function(a){422===a.status&&(c.handle422(a.data),e())})};var e=function(){jQuery(".content-workspace > .dimmer").removeClass("active")}}]),angular.module("erestoApp").controller("UsersCtrl",["$scope","$rootScope","User",function(a,b,c){a.users={},a.selected={},a.formType="existing",a.selectedID=null,b.controller="users",b.total=1,b.initial=function(b){var d=b||1;c.eresto(d).then(function(b){a.users=b.users,jQuery(".search").removeClass("loading"),b.users.length>0&&(a.selected=angular.copy(b.users[0]),a.selectedID=0,g())})},b.addNew=function(){a.selected={},a.formType="new"},a.selectUser=function(b){a.selected=angular.copy(a.users[b]),a.selectedID=b,a.formType="existing",jQuery("label.error").remove(),jQuery("input.error, select.error, textarea.error").removeClass("error"),g()},a.saveData=function(){var b=jQuery(".entry-form");b.validate(),b.valid()&&(a.selected.profile_attributes.join_at=f(a.selected.profile_attributes.join_at),a.selected.profile_attributes.contract_until=f(a.selected.profile_attributes.contract_until),"new"===a.formType?(a.selected.role="eresto",c.save(a.selected).then(function(b){a.users.push(b.user),a.selected=angular.copy(b.user),g(),d()},function(a){422===a.status&&(c.handle422(a.data),d())})):c.update(a.selected).then(function(b){a.users[a.selectedID]=b.user,a.selected=angular.copy(b.user),g(),d()},function(a){422===a.status&&(c.handle422(a.data),d())}))};var d=function(){jQuery(".content-workspace > .dimmer").removeClass("active")},e=function(a){return null!==a||void 0!==a?moment(a).format("ddd, D MMM YYYY"):" "},f=function(a){return null!==a||void 0!==a?moment(a).format("YYYY-MM-D"):" "},g=function(){a.selected.profile_attributes.join_at=e(a.selected.profile_attributes.join_at),a.selected.profile_attributes.contract_until=e(a.selected.profile_attributes.contract_until)}}]);var app=angular.module("autocomplete",[]);app.directive("autocomplete",function(){var a=-1;return{restrict:"E",scope:{searchParam:"=ngModel",suggestions:"=data",onType:"=onType",onChange:"=onChange",onSelect:"=onSelect",autocompleteRequired:"=",autocompleteDisabled:"="},controller:["$scope",function(a){a.selectedIndex=-1,a.initLock=!0,a.setIndex=function(b){a.selectedIndex=parseInt(b)},this.setIndex=function(b){a.setIndex(b),a.$apply()},a.getIndex=function(b){return a.selectedIndex};var b=!0;a.completing=!1,a.$watch("searchParam",function(c,d){d===c||!d&&a.initLock||(b&&"undefined"!=typeof a.searchParam&&null!==a.searchParam&&(a.completing=!0,a.searchFilter=a.searchParam,a.selectedIndex=-1),a.onType&&a.onType(a.searchParam))}),this.preSelect=function(c){b=!1,a.$apply(),b=!0},a.preSelect=this.preSelect,this.preSelectOff=function(){b=!0},a.preSelectOff=this.preSelectOff,a.select=function(c){c&&(a.searchParam=c,a.searchFilter=c,a.onSelect&&a.onSelect(c)),b=!1,a.completing=!1,setTimeout(function(){b=!0},1e3),a.setIndex(-1)}}],link:function(b,c,d){setTimeout(function(){b.initLock=!0,b.$apply()},250);var e="";b.attrs={placeholder:"select or create new one","class":"",id:"",inputclass:"",inputid:"",name:""};for(var f in d)e=f.replace("attr","").toLowerCase(),0===f.indexOf("attr")&&(b.attrs[e]=d[f]);d.clickActivation&&(c[0].onclick=function(a){b.searchParam||setTimeout(function(){b.completing=!0,b.$apply()},200)});var g={left:37,up:38,right:39,down:40,enter:13,esc:27,tab:9};document.addEventListener("keydown",function(a){var c=a.keyCode||a.which;switch(c){case g.esc:b.select(),b.setIndex(-1),b.$apply(),a.preventDefault()}},!0),document.addEventListener("blur",function(a){setTimeout(function(){b.select(),b.setIndex(-1),b.$apply()},150)},!0),c[0].addEventListener("keydown",function(c){var d=c.keyCode||c.which,e=angular.element(this).find("li").length;if(b.completing&&0!=e)switch(d){case g.up:if(a=b.getIndex()-1,-1>a)a=e-1;else if(a>=e){a=-1,b.setIndex(a),b.preSelectOff();break}b.setIndex(a),-1!==a&&b.preSelect(angular.element(angular.element(this).find("li")[a]).text()),b.$apply();break;case g.down:if(a=b.getIndex()+1,-1>a)a=e-1;else if(a>=e){a=-1,b.setIndex(a),b.preSelectOff(),b.$apply();break}b.setIndex(a),-1!==a&&b.preSelect(angular.element(angular.element(this).find("li")[a]).text());break;case g.left:break;case g.right:case g.enter:case g.tab:a=b.getIndex(),-1!==a?(b.select(angular.element(angular.element(this).find("li")[a]).text()),d==g.enter&&c.preventDefault()):d==g.enter&&b.select(),b.setIndex(-1),b.$apply();break;case g.esc:b.select(),b.setIndex(-1),b.$apply(),c.preventDefault();break;default:return}})},template:'        <div class="autocomplete {{ attrs.class }}" id="{{ attrs.id }}">          <input            type="text"            ng-model="searchParam"            placeholder="{{ attrs.placeholder }}"            class="{{ attrs.inputclass }}"            id="{{ attrs.inputid }}"            name="{{ attrs.name }}"            ng-change="onChange"            ng-disabled="{{ autocompleteDisabled }}"            ng-required="{{ autocompleteRequired }}" />          <ul ng-show="completing && (suggestions | filter:searchFilter).length > 0">            <li              suggestion              ng-repeat="suggestion in suggestions | filter:searchFilter | orderBy:\'toString()\' track by $index"              index="{{ $index }}"              val="{{ suggestion }}"              ng-class="{ active: ($index === selectedIndex) }"              ng-click="select(suggestion)"              ng-bind-html="suggestion | highlight:searchParam"></li>          </ul>        </div>'}}),app.filter("highlight",["$sce",function(a){return function(b,c){if("function"==typeof b)return"";if(c){var d="("+c.split(/\ /).join(" |")+"|"+c.split(/\ /).join("|")+")",e=new RegExp(d,"gi");d.length&&(b=b.replace(e,'<span class="highlight">$1</span>'))}return a.trustAsHtml(b)}}]),app.directive("suggestion",function(){return{restrict:"A",require:"^autocomplete",link:function(a,b,c,d){b.bind("mouseenter",function(){d.preSelect(c.val),d.setIndex(c.index)}),b.bind("mouseleave",function(){d.preSelectOff()})}}}),angular.module("angularify.semantic.dropdown",[]).controller("DropDownController",["$scope",function(a){a.options=[],this.add_option=function(b,c){a.options.push({title:b,value:c}),c==a.model&&this.update_title(c)},this.remove_option=function(b,c){for(var d in a.options)if(a.options[d].value==c&&a.options[d].title==b){a.options.splice(d,1);break}},this.update_model=function(b,c){a.model!==c&&(a.model=c)},this.update_title=function(b){var c=!1;for(var d in a.options)a.options[d].value==b&&(a.title=a.options[d].title,
c=!0);c?a.text_class="text":(a.title=b,a.text_class="text")}}]).directive("dropdown",function(){return{restrict:"E",replace:!0,transclude:!0,controller:"DropDownController",scope:{title:"@",open:"@",model:"=ngModel"},template:'<div class="{{ dropdown_class }}"><div class="{{text_class}}">{{ title }}</div><i class="dropdown icon"></i><div class="{{ menu_class }}"  ng-transclude></div></div>',link:function(a,b,c,d){a.dropdown_class="ui selection dropdown",a.menu_class="menu transition hidden",a.text_class="default text",a.original_title=a.title,"true"===a.open?(a.is_open=!0,a.dropdown_class=a.dropdown_class+" active visible",a.menu_class=a.menu_class+" visible"):a.is_open=!1,a.toTitleCase=function(a){return a.replace("_"," ").replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})},a.element=b,a.$watch("model",function(a){var c="";console.log(a),c=void 0!==a&&""!==a&&void 0!==$(".item."+a).children()[0]?$(".item."+a).children()[0].innerHTML:jQuery(b).attr("title"),d.update_title(c)}),b.bind("click",function(){a.is_open===!1?a.$apply(function(){a.dropdown_class="ui selection dropdown active visible",a.menu_class="menu transition visible"}):a.$apply(function(){a.dropdown_class="ui selection dropdown",a.menu_class="menu transition hidden"}),a.is_open=!a.is_open})}}}).directive("dropdownGroup",function(){return{restrict:"AE",replace:!0,transclude:!0,require:"^dropdown",scope:{title:"=title",value:"=value"},template:'<div class="item {{item_value}}" ng-transclude>{{ item_title }}</div>',link:function(a,b,c,d){void 0===a.title?a.item_title=b.children()[0].innerHTML:a.item_title=a.title,void 0===a.value?a.item_value=c.value||a.item_title:a.item_value=a.value,d.add_option(a.item_title,a.item_value),b.bind("click",function(){d.update_model(a.item_title,a.item_value),d.update_title($(this).children()[0].innerHTML)}),a.$on("$destroy",function(){d.remove_option(a.item_title,a.item_value)})}}});var validateEmail=function(a){var b=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return b.test(a)},loginInputSubmit=function(a,b,c){if("one"===b){var d=a.val();if(validateEmail(d)){jQuery(a).parent().children(":not(.icons)").toggleClass("hide");var e=jQuery(a).siblings(".icons"),f=jQuery(a).parent().parent(),g=parseInt(f.css("width"));e.css("left",g+50+"px"),setTimeout(function(){jQuery(".one").toggleClass("hide"),jQuery(".one").parent().css("width","250px"),jQuery(".two").toggleClass("hide"),jQuery(".two").find("input").focus(),jQuery(a).parent().children(":not(.icons)").toggleClass("hide"),e.css("left","0px")},500)}else{var h=a.parent().parent();h.addClass("animated shake"),setTimeout(function(){h.removeClass("animated shake")},1e3)}}else{jQuery(a).parent().children(":not(.icons)").toggleClass("hide");var i=jQuery(a).siblings(".icons"),j=jQuery(a).parent().parent(),k=parseInt(j.css("width"));i.css("left",k+50+"px"),setTimeout(function(){jQuery(".two").toggleClass("hide"),jQuery(".two").parent().css("width","250px"),jQuery(a).parent().parent().toggleClass("hide"),jQuery(".three").removeClass("hide"),jQuery(a).parent().children(":not(.icons)").toggleClass("hide"),i.css("left","0px")},10),c.doLogin()}};App.factory("Excel",["$window",function(a){var b="data:application/vnd.ms-excel;base64,",c='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',d=function(b){return a.btoa(unescape(encodeURIComponent(b)))},e=function(a,b){return a.replace(/{(\w+)}/g,function(a,c){return b[c]})};return{tableToExcel:function(a,f){var g=$(a),h={worksheet:f,table:g.html()},i=b+d(e(c,h));return i}}}]).directive("exportTable",function(){return{restrict:"C",link:function(a,b,c){a.$on("export-pdf",function(a,c){b.tableExport({type:"pdf",escape:!1})}),a.$on("export-excel",function(a,c){b.tableExport({type:"excel",escape:!1})}),a.$on("export-doc",function(a,c){b.tableExport({type:"doc",escape:!1})})}}}).directive("autogrow",function(){return{restrict:"A",link:function(a,b){b.bind("change keyup paste",function(){var a=b.parent().parent(),c=b.val();if(c.length>9){var d=12.2*c.length,e=d+140;a.css("width",e+"px"),b.css("width",d+"px")}else a.css("width","250px"),b.css("width","108px")})}}}).directive("step",function(){return{restrict:"A",link:function(a,b,c){b.bind("keypress",function(d){(13===d.keyCode||9===d.keyCode)&&loginInputSubmit(b,c.step,a)})}}}).directive("continue",function(){return{restrict:"A",link:function(a,b){b.bind("click",function(){b.addClass("hide").next().removeClass("hide"),jQuery(".one").find("input").focus()})}}}).directive("btnStep",function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(){var d=b.before();loginInputSubmit(d,c.btnStep,a)})}}}).directive("loginBtn",function(){return{restrict:"A",link:function(a,b){a.$on("auth-error",function(){jQuery(b).addClass("hide");var a=jQuery(".one");a.parent().removeClass("hide"),a.removeClass("hide"),a.find("input").focus(),setTimeout(function(){a.parent().addClass("animated shake")},100),setTimeout(function(){a.parent().removeClass("animated shake")},1100)})}}}).directive("contentWorkspace",["$window",function(a){return{restrict:"C",link:function(b,c){var d=a.innerHeight-100,e=jQuery(document).height()-100;d=d>e?d:e,jQuery(c).css("min-height",d+"px"),jQuery(".content-workspace.report").css("height",d+10+"px"),jQuery("#content").css("min-height",a.innerHeight+"px")}}}]).directive("pickaday",function(){return{restrict:"C",link:function(a,b){new Pikaday({field:jQuery(b)[0],format:"ddd, D MMM YYYY"})}}}).directive("pikaday",function(){return{restrict:"C",link:function(a,b){new Pikaday({field:jQuery(b)[0],format:"DD/MM/YYYY"})}}}).directive("hidePanel",function(){return{restrict:"C",link:function(a,b){b.bind("click",function(){jQuery(b).parent().removeClass("active")})}}}).directive("ngSearch",["$rootScope",function(a){return{restrict:"A",link:function(b,c){var d=c.find(".search");d.bind("click",function(){d.addClass("loading"),jQuery("#search").focus(),(null===a.search||void 0===a.search.field)&&(a.search=null),a.initial(a.page)})}}}]).directive("sidebar",function(){return{restrict:"C",link:function(a,b){jQuery(b).enscroll({showOnHover:!0,verticalTrackClass:"track3",verticalHandleClass:"handle3"})}}}).directive("checkbox",function(){return{restrict:"C",link:function(a,b){jQuery(b).checkbox()}}}).filter("range",function(){return function(a,b){b=parseInt(b);for(var c=0;b>c;c++)a.push(c);return a}}).filter("dinein",function(){return function(a){for(var b=0,c=0;c<a.length;c++)a[c].take_away||a[c]["void"]||b++;return b>0?b+" items":"0 item"}}).filter("takeaway",function(){return function(a){for(var b=0,c=0;c<a.length;c++)a[c].take_away&&!a[c]["void"]&&b++;return b>0?b+" items":"0 item"}}).filter("prices",function(){return function(a){for(var b=0,c=0;c<a.length;c++)b+=parseInt(a[c].paid_amount);return"Rp "+b.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")}}).filter("mycurrency",function(){return function(a){var b=parseInt(a);return"Rp "+b.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")}}).filter("served",function(){return function(a){for(var b=!0,c=0;c<a.length;c++)a[c].served||(b=!1);var d=b?"Yes":"No";return d}}).filter("getdate",function(){return function(a){var b=new Date(a);return moment(b).format("MMMM Do YYYY")}}).filter("gettime",function(){return function(a){var b=new Date(a);return moment(b).format("h:mm:ss a")}}),function(){function a(a){function c(a,b,c){}var d={controller:b,link:c,restrict:"EA",template:'<i class="food icon"></i><div class="content"><div class="header">{{product.name || "No name"}}</div><div class="description"><b>{{ cat.name }}</b> - {{ sub_cat.name}}</div></div>',scope:{product:"=",categories:"="}};return d}function b(a,b){a.cat={},a.cat=b.find(a.categories,{id:a.product.serv_category}),a.sub_cat=b.find(a.cat.sub_categories,{id:a.product.serv_sub_category})}angular.module("erestoApp").directive("productList",a),a.$inject=["lodash"],b.$inject=["$scope","lodash"]}(),App.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/dashboard"),b.when("","/dashboard"),a.state("app",{url:"","abstract":!0,templateUrl:"views/layouts/application.html",controller:"MainCtrl",params:{token:null},resolve:{currentUser:["Cancan",function(a){return a.identity(!0)}]}}).state("app.dashboard",{url:"/dashboard",templateUrl:"views/dashboard/index.html",controller:"DashboardCtrl"}).state("app.restricted",{url:"/","abstract":!0,resolve:{authorize:["Authenticate",function(a){return a.authorize()}]},template:"<div ui-view> </div>"}).state("app.restricted.outlets",{url:"outlets",data:{roles:["owner","manager"]},templateUrl:"views/outlets/index.html",controller:"OutletsCtrl"}).state("app.restricted.staff",{url:"staff",data:{roles:["manager"]},templateUrl:"views/staffs/index.html",controller:"StaffCtrl"}).state("app.restricted.products",{url:"products",data:{roles:["manager","captain"]},templateUrl:"views/products/index.html",controller:"ProductsCtrl"}).state("app.restricted.tables",{url:"cards",data:{roles:["manager"]},templateUrl:"views/tables/index.html",controller:"TablesCtrl"}).state("app.restricted.discounts",{url:"discounts",data:{roles:["manager"]},templateUrl:"views/discounts/index.html",controller:"DiscountsCtrl"}).state("app.restricted.settings",{url:"settings",data:{roles:["manager","captain","owner"]},templateUrl:"views/settings/index.html",controller:"SettingsCtrl"}).state("app.restricted.orders",{url:"orders",data:{roles:["manager","captain","tenant","owner"]},templateUrl:"views/orders/index.html",controller:"OrdersCtrl"}).state("app.restricted.reports",{url:"reports",data:{roles:["manager","captain","tenant","owner"]},templateUrl:"views/reports/index.html",controller:"ReportsCtrl"}).state("welcome",{url:"/welcome",templateUrl:"views/auth/index.html",controller:"AuthCtrl"})}]),angular.module("erestoApp").factory("Authenticate",["$rootScope","$state","Cancan",function(a,b,c){return{authorize:function(){return c.identity().then(function(){var d=c.isAuthenticated();void 0!==a.toState.data&&"app.dashboard"!==a.toState.name&&a.toState.data.roles&&a.toState.data.roles.length>0&&!c.isInAnyRole(a.toState.data.roles)&&(d?b.go("app.dashboard"):(a.returnToState=a.toState,a.returnToStateParams=a.toStateParams,b.go("welcome")))})}}}]),angular.module("erestoApp").factory("Cancan",["$q","$http","User",function(a,b,c){var d=void 0,e=!1;return{isIdentityResolved:function(){return angular.isDefined(d)},isAuthenticated:function(){return e},isInRole:function(a){return e&&d.role?-1!==d.role.indexOf(a):!1},isInAnyRole:function(a){if(!e||!d.role)return!1;for(var b=0;b<a.length;b++)if(this.isInRole(a[b]))return!0;return!1},authenticate:function(a){d=a,e=null!==a},identity:function(b){var f=a.defer();return b===!0&&(d=void 0),angular.isDefined(d)?(f.resolve(d),f.promise):(c.me().then(function(a){d=a.user,e=!0,f.resolve(d)},function(){d=null,e=!1,f.resolve(d)}),f.promise)}}}]),angular.module("erestoApp").factory("Discount",["Restangular","$rootScope",function(a,b){return{getData:function(c){if(b.search){var d={};return angular.extend(d,{page:c},b.search),a.one("discounts","search").customGET("",d)}return a.all("discounts").customGET("",{page:c})},save:function(b){return jQuery(".content-workspace > .dimmer").addClass("active"),a.all("discounts").customPOST({discount:b},null,{},{})},update:function(b){return jQuery(".content-workspace > .dimmer").addClass("active"),a.one("discounts",b.id).customPUT({discount:b},null,{},{})},"delete":function(b){return jQuery(".content-workspace > .dimmer").addClass("active"),a.one("discounts",b.id).remove()},handle422:function(a){for(var b in a){var c=b.charAt(0).toUpperCase()+b.slice(1);jQuery("#"+b).after('<label class="error">'+c+" "+a[b][0]+"</label>")}return!0}}}]),angular.module("erestoApp").factory("Order",["Restangular",function(a){return{getData:function(b){return a.one("orders","search").customGET("",b)},getProductSales:function(b){return a.one("order_items","search").customGET("",b)},getGraphRevenue:function(b){return a.one("orders","graph_by_revenue").customGET("",b)},getGraphOrder:function(b){return a.one("orders","graph_by_order").customGET("",b)},getGraphPax:function(b){return a.one("orders","graph_by_pax").customGET("",b)},getGraphTax:function(b){return a.one("orders","graph_by_tax").customGET("",b)}}}]),angular.module("erestoApp").factory("Outlet",["Restangular","$rootScope",function(a,b){return{authenticate:function(b){return a.all("sessions").customPOST({outlet:b},null,{},{})},me:function(){return a.one("me").get()},getData:function(c){if(b.search){var d={};return angular.extend(d,{page:c},b.search),a.one("outlets","search").customGET("",d)}return a.all("outlets").customGET("",{page:c})},getAll:function(b){return a.one("outlets","all").get()},save:function(b){return jQuery(".content-workspace > .dimmer").addClass("active"),a.all("outlets").customPOST({outlet:b},null,{},{})},update:function(b){return jQuery(".content-workspace > .dimmer").addClass("active"),a.one("outlets",b.id).customPUT({outlet:b},null,{},{})},handle422:function(a){for(var b in a){var c=b.charAt(0).toUpperCase()+b.slice(1);jQuery("#"+b).after('<label class="error">'+c+" "+a[b][0]+"</label>")}return!0}}}]).factory("Cloud",["Restangular",function(a){return a.withConfig(function(a){a.setBaseUrl("http://api-bober.eresto.io/v1")})}]),angular.module("erestoApp").factory("Printer",["Restangular",function(a){return{getData:function(){return a.one("printers","all").get()},save:function(b){return jQuery(".dimmer.printer").addClass("active"),a.all("printers").customPOST({printer:b},null,{},{})},update:function(b){return jQuery(".dimmer.printer").addClass("active"),a.one("printers",b.id).customPUT({printer:b},null,{},{})},"delete":function(b){return jQuery(".dimmer.printer").addClass("active"),a.one("printers",b.id).remove()}}}]),angular.module("erestoApp").factory("Product",["Restangular","$rootScope",function(a,b){return{getData:function(c){if(b.search){var d={};return angular.extend(d,{page:c},b.search),a.one("products","search").customGET("",d)}return a.all("products").customGET("",{page:c})},category:function(){return a.one("products","category").get()},save:function(b){return jQuery(".content-workspace > .dimmer").addClass("active"),a.all("products").customPOST({product:b},null,{},{})},update:function(b){return jQuery(".content-workspace > .dimmer").addClass("active"),a.one("products",b.id).customPUT({product:b},null,{},{})},handle422:function(a){for(var b in a){var c=b.charAt(0).toUpperCase()+b.slice(1);jQuery("#"+b).after('<label class="error">'+c+" "+a[b][0]+"</label>")}return!0}}}]),angular.module("erestoApp").factory("Random",function(){return{generate:function(a){for(var b=a||20,c="",d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=0;b>e;e++)c+=d.charAt(Math.floor(Math.random()*d.length));return c}}}),angular.module("erestoApp").factory("Table",["Restangular","$rootScope",function(a,b){return{getData:function(){if(b.search){var c={};return angular.extend(c,b.search),a.one("tables","search").customGET("",c)}return a.one("tables","").get()},save:function(b){return jQuery(".content-workspace > .dimmer").addClass("active"),a.all("tables").customPOST({table:b},null,{},{})},update:function(b){return jQuery(".content-workspace > .dimmer").addClass("active"),a.one("tables",b.location).customPUT({table:b},null,{},{})},handle422:function(a){for(var b in a){var c=b.charAt(0).toUpperCase()+b.slice(1);jQuery("#"+b).after('<label class="error">'+c+" "+a[b][0]+"</label>")}return!0}}}]),angular.module("erestoApp").factory("User",["Restangular","$rootScope",function(a,b){return{authenticate:function(b){return a.all("sessions").customPOST({user:b},null,{},{})},me:function(){return a.one("me").get()},eresto:function(c){if(b.search){var d={};return angular.extend(d,{"filter[role]":"eresto",page:c},b.search),a.one("users","search").customGET("",d)}return a.all("users").customGET("",{"filter[role]":"eresto",page:c})},getData:function(c){if(b.search){var d={};return angular.extend(d,{page:c},b.search),a.one("users","search").customGET("",d)}return a.all("users").customGET("",{page:c})},getAll:function(b,c){var d={};return b&&(d.role=b),c&&(d.outlet_id=c),a.all("users").customGET("",d)},save:function(b){return jQuery(".content-workspace > .dimmer").addClass("active"),a.all("users").customPOST({user:b},null,{},{})},update:function(b){return jQuery(".content-workspace > .dimmer").addClass("active"),a.one("users",b.id).customPUT({user:b},null,{},{})},handle422:function(a){for(var b in a){var c=b.charAt(0).toUpperCase()+b.slice(1);jQuery("#"+b).after('<label class="error">'+c+" "+a[b][0]+"</label>")}return!0}}}]);